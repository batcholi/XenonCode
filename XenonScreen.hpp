#pragma once

#include <algorithm>
#include <array>
#include <cstdint>
#include <cstring>
#include <string>
#include <string_view>
#include <vector>
#include <cmath>

#define XENONCODE_COLOR(r,g,b,a) ((uint32_t(a) << 24) | (uint32_t(b) << 16) | (uint32_t(g) << 8) | uint32_t(r))
#define XENONCODE_COLOR_R(color) (uint32_t(color) & 0xFF)
#define XENONCODE_COLOR_G(color) ((uint32_t(color) >> 8) & 0xFF)
#define XENONCODE_COLOR_B(color) ((uint32_t(color) >> 16) & 0xFF)
#define XENONCODE_COLOR_A(color) ((uint32_t(color) >> 24) & 0xFF)

#define XENONCODE_DEFAULT_COLOR XENONCODE_COLOR(8,255,255,255)

#define XENONCODE_NONE		uint32_t(0b00000)
#define XENONCODE_LEFT		uint32_t(0b00001)
#define XENONCODE_RIGHT		uint32_t(0b00010)
#define XENONCODE_TOP		uint32_t(0b00100)
#define XENONCODE_BOTTOM	uint32_t(0b01000)
#define XENONCODE_CENTER	uint32_t(0b10000)
#define XENONCODE_TOP_LEFT (XENONCODE_TOP | XENONCODE_LEFT)
#define XENONCODE_TOP_RIGHT (XENONCODE_TOP | XENONCODE_RIGHT)
#define XENONCODE_BOTTOM_LEFT (XENONCODE_BOTTOM | XENONCODE_LEFT)
#define XENONCODE_BOTTOM_RIGHT (XENONCODE_BOTTOM | XENONCODE_RIGHT)

class XenonFontRenderer {
	
	static constexpr std::size_t kMaxGlyphPixels = 49;
	static constexpr uint32_t kFirstCodepoint = 32;
	static constexpr uint32_t kLastCodepoint = 255;

	struct XenonGlyph {
		uint16_t codepoint;
		uint8_t width;
		uint8_t height;
		int8_t top;
		int8_t left;
		std::array<uint8_t, kMaxGlyphPixels> bitmap;
	};

	static constexpr XenonGlyph xenonGlyphs[] = {
		{ 32, 0, 0, 0, 0, {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // (space)
		{ 33, 1, 7, 7, 2, {1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // !
		{ 34, 3, 3, 7, 1, {1,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // "
		{ 35, 5, 7, 7, 0, {0,1,0,1,0,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // #
		{ 36, 5, 7, 7, 0, {0,0,1,0,0,0,1,1,1,1,1,0,1,0,0,0,1,1,1,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // $
		{ 37, 5, 7, 7, 0, {1,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // %
		{ 38, 5, 7, 7, 0, {0,1,1,0,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,1,0,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // &
		{ 39, 2, 3, 7, 1, {1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // '
		{ 40, 3, 7, 7, 1, {0,0,1,0,1,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // (
		{ 41, 3, 7, 7, 1, {1,0,0,0,1,0,0,0,1,0,0,1,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // )
		{ 42, 3, 3, 6, 1, {1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // *
		{ 43, 5, 5, 6, 0, {0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // +
		{ 44, 2, 3, 3, 1, {1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ,
		{ 45, 5, 1, 4, 0, {1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // -
		{ 46, 2, 2, 2, 1, {1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // .
		{ 47, 5, 5, 6, 0, {0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // /
		{ 48, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,1,1,1,0,1,0,1,1,1,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 0
		{ 49, 3, 7, 7, 1, {0,1,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 1
		{ 50, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 2
		{ 51, 5, 7, 7, 0, {1,1,1,1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 3
		{ 52, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 4
		{ 53, 5, 7, 7, 0, {1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 5
		{ 54, 5, 7, 7, 0, {0,0,1,1,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 6
		{ 55, 5, 7, 7, 0, {1,1,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 7
		{ 56, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 8
		{ 57, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // 9
		{ 58, 2, 5, 6, 1, {1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // :
		{ 59, 2, 6, 6, 1, {1,1,1,1,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ;
		{ 60, 4, 7, 7, 0, {0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // <
		{ 61, 5, 3, 5, 0, {1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // =
		{ 62, 4, 7, 7, 1, {1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // >
		{ 63, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ?
		{ 64, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // @
		{ 65, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // A
		{ 66, 5, 7, 7, 0, {1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // B
		{ 67, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // C
		{ 68, 5, 7, 7, 0, {1,1,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // D
		{ 69, 5, 7, 7, 0, {1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // E
		{ 70, 5, 7, 7, 0, {1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // F
		{ 71, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // G
		{ 72, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // H
		{ 73, 3, 7, 7, 1, {1,1,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // I
		{ 74, 5, 7, 7, 0, {0,0,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // J
		{ 75, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // K
		{ 76, 5, 7, 7, 0, {1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // L
		{ 77, 5, 7, 7, 0, {1,0,0,0,1,1,1,0,1,1,1,0,1,0,1,1,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // M
		{ 78, 5, 7, 7, 0, {1,0,0,0,1,1,1,0,0,1,1,1,0,0,1,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // N
		{ 79, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // O
		{ 80, 5, 7, 7, 0, {1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // P
		{ 81, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,1,0,1,1,0,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Q
		{ 82, 5, 7, 7, 0, {1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // R
		{ 83, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // S
		{ 84, 5, 7, 7, 0, {1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // T
		{ 85, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // U
		{ 86, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // V
		{ 87, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,1,0,1,1,0,1,0,1,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // W
		{ 88, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // X
		{ 89, 5, 7, 7, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Y
		{ 90, 5, 7, 7, 0, {1,1,1,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Z
		{ 91, 3, 7, 7, 1, {1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // [
		{ 92, 5, 5, 6, 0, {1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // \ (backslash)
		{ 93, 3, 7, 7, 1, {1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ]
		{ 94, 5, 3, 7, 0, {0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ^
		{ 95, 5, 1, 1, 0, {1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // _
		{ 96, 3, 3, 7, 1, {1,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // `
		{ 97, 5, 5, 5, 0, {0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // a
		{ 98, 5, 7, 7, 0, {1,0,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // b
		{ 99, 5, 5, 5, 0, {0,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // c
		{ 100, 5, 7, 7, 0, {0,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // d
		{ 101, 5, 5, 5, 0, {0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // e
		{ 102, 4, 7, 7, 0, {0,0,1,1,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // f
		{ 103, 5, 5, 5, 0, {0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // g
		{ 104, 5, 7, 7, 0, {1,0,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // h
		{ 105, 3, 7, 7, 1, {0,1,0,0,0,0,1,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // i
		{ 106, 4, 7, 7, 0, {0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // j
		{ 107, 4, 7, 7, 0, {1,0,0,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // k
		{ 108, 3, 7, 7, 1, {1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // l
		{ 109, 5, 5, 5, 0, {1,1,0,1,0,1,0,1,0,1,1,0,1,0,1,1,0,1,0,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // m
		{ 110, 5, 5, 5, 0, {1,0,1,1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // n
		{ 111, 5, 5, 5, 0, {0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // o
		{ 112, 5, 5, 5, 0, {1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // p
		{ 113, 5, 5, 5, 0, {0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // q
		{ 114, 5, 5, 5, 0, {1,0,1,1,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // r
		{ 115, 5, 5, 5, 0, {0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // s
		{ 116, 5, 7, 7, 0, {0,1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // t
		{ 117, 5, 5, 5, 0, {1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // u
		{ 118, 5, 5, 5, 0, {1,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // v
		{ 119, 5, 5, 5, 0, {1,0,0,0,1,1,0,0,0,1,1,0,1,0,1,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // w
		{ 120, 5, 5, 5, 0, {1,1,0,0,1,0,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // x
		{ 121, 5, 5, 5, 0, {1,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // y
		{ 122, 5, 5, 5, 0, {1,1,1,1,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // z
		{ 123, 3, 7, 7, 0, {0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // {
		{ 124, 1, 7, 7, 2, {1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // |
		{ 125, 3, 7, 7, 2, {1,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // }
		{ 126, 5, 3, 5, 0, {0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ~
		{ 127, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 128, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 129, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 130, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 131, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 132, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 133, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 134, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 135, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 136, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 137, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 138, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 139, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 140, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 141, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 142, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 143, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 144, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 145, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 146, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 147, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 148, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 149, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 150, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 151, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 152, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 153, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 154, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 155, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 156, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 157, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 158, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 159, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 160, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 161, 1, 7, 7, 2, {1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¡ (0xA1)
		{ 162, 5, 7, 7, 0, {0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,0,1,0,0,1,0,1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¢ (0xA2)
		{ 163, 5, 7, 7, 0, {0,0,1,1,0,0,1,0,0,1,0,1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // £ (0xA3)
		{ 164, 5, 5, 6, 0, {1,0,0,0,1,0,1,1,1,0,0,1,0,1,0,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¤ (0xA4)
		{ 165, 5, 7, 7, 0, {1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¥ (0xA5)
		{ 166, 1, 7, 7, 2, {1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¦ (0xA6)
		{ 167, 5, 7, 7, 0, {0,1,1,1,0,1,0,0,0,1,0,1,1,0,0,0,1,0,1,0,0,0,1,1,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // § (0xA7)
		{ 168, 3, 1, 7, 1, {1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¨ (0xA8)
		{ 169, 5, 7, 7, 0, {1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // © (0xA9)
		{ 170, 5, 7, 7, 0, {0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ª (0xAA)
		{ 171, 5, 6, 7, 0, {0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // « (0xAB)
		{ 172, 5, 2, 6, 0, {1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¬ (0xAC)
		{ 173, 3, 1, 4, 1, {1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ­(0xAD)
		{ 174, 5, 7, 7, 0, {1,1,1,1,1,1,0,0,1,1,1,0,1,0,1,1,0,0,1,1,1,0,1,0,1,1,0,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ® (0xAE)
		{ 175, 5, 1, 7, 0, {1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¯ (0xAF)
		{ 176, 4, 4, 7, 0, {0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ° (0xB0)
		{ 177, 5, 7, 7, 0, {0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ± (0xB1)
		{ 178, 3, 5, 7, 1, {1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ² (0xB2)
		{ 179, 3, 5, 7, 1, {1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ³ (0xB3)
		{ 180, 3, 3, 7, 2, {0,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ´ (0xB4)
		{ 181, 5, 5, 5, 0, {1,0,0,1,0,1,0,0,1,0,1,1,1,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // µ (0xB5)
		{ 182, 5, 7, 7, 0, {1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¶ (0xB6)
		{ 183, 1, 1, 4, 2, {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // · (0xB7)
		{ 184, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 185, 3, 5, 7, 1, {0,1,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¹ (0xB9)
		{ 186, 3, 5, 7, 1, {1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // º (0xBA)
		{ 187, 5, 6, 7, 0, {1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // » (0xBB)
		{ 188, 5, 7, 7, 0, {0,1,0,0,0,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,1,0,1,1,0,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¼ (0xBC)
		{ 189, 5, 7, 7, 0, {0,1,0,0,0,1,1,0,0,1,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ½ (0xBD)
		{ 190, 7, 7, 7, 0, {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1} },
		{ 191, 5, 7, 7, 0, {0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ¿ (0xBF)
		{ 192, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // À (0xC0)
		{ 193, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Á (0xC1)
		{ 194, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Â (0xC2)
		{ 195, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ã (0xC3)
		{ 196, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ä (0xC4)
		{ 197, 5, 7, 7, 0, {0,1,1,1,0,0,1,0,1,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Å (0xC5)
		{ 198, 5, 7, 7, 0, {0,0,1,1,1,0,1,1,0,0,1,0,1,0,0,1,0,1,1,1,1,1,1,0,0,1,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Æ (0xC6)
		{ 199, 5, 7, 7, 0, {0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ç (0xC7)
		{ 200, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // È (0xC8)
		{ 201, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // É (0xC9)
		{ 202, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ê (0xCA)
		{ 203, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ë (0xCB)
		{ 204, 3, 7, 7, 1, {1,0,0,0,1,0,1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ì (0xCC)
		{ 205, 3, 7, 7, 1, {0,0,1,0,1,0,1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Í (0xCD)
		{ 206, 3, 7, 7, 1, {0,1,0,1,0,1,1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Î (0xCE)
		{ 207, 3, 7, 7, 1, {1,0,1,0,0,0,1,1,1,0,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ï (0xCF)
		{ 208, 5, 7, 7, 0, {0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,1,1,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ð (0xD0)
		{ 209, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ñ (0xD1)
		{ 210, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ò (0xD2)
		{ 211, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ó (0xD3)
		{ 212, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ô (0xD4)
		{ 213, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Õ (0xD5)
		{ 214, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ö (0xD6)
		{ 215, 5, 5, 6, 0, {1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // × (0xD7)
		{ 216, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,1,0,1,1,0,1,1,1,0,1,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ø (0xD8)
		{ 217, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ù (0xD9)
		{ 218, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ú (0xDA)
		{ 219, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Û (0xDB)
		{ 220, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ü (0xDC)
		{ 221, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Ý (0xDD)
		{ 222, 5, 7, 7, 0, {1,0,0,0,0,1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // Þ (0xDE)
		{ 223, 5, 6, 6, 0, {0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ß (0xDF)
		{ 224, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // à (0xE0)
		{ 225, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // á (0xE1)
		{ 226, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // â (0xE2)
		{ 227, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ã (0xE3)
		{ 228, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ä (0xE4)
		{ 229, 5, 7, 7, 0, {0,1,1,1,0,0,1,0,1,0,0,1,1,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // å (0xE5)
		{ 230, 5, 5, 5, 0, {1,1,0,1,0,0,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // æ (0xE6)
		{ 231, 4, 6, 6, 0, {0,1,1,1,1,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ç (0xE7)
		{ 232, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // è (0xE8)
		{ 233, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // é (0xE9)
		{ 234, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ê (0xEA)
		{ 235, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ë (0xEB)
		{ 236, 3, 7, 7, 1, {1,0,0,0,1,0,0,0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ì (0xEC)
		{ 237, 3, 7, 7, 1, {0,0,1,0,1,0,0,0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // í (0xED)
		{ 238, 3, 7, 7, 1, {0,1,0,1,0,1,0,0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // î (0xEE)
		{ 239, 3, 7, 7, 1, {1,0,1,0,0,0,0,0,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ï (0xEF)
		{ 240, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,1,1,0,0,0,1,0,0,1,0,1,0,1,0,1,1,0,1,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ð (0xF0)
		{ 241, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,0,0,0,0,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ñ (0xF1)
		{ 242, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ò (0xF2)
		{ 243, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ó (0xF3)
		{ 244, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ô (0xF4)
		{ 245, 5, 7, 7, 0, {0,1,0,0,1,1,0,1,1,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // õ (0xF5)
		{ 246, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ö (0xF6)
		{ 247, 5, 5, 6, 0, {0,0,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ÷ (0xF7)
		{ 248, 5, 5, 5, 0, {0,0,1,0,0,0,1,0,1,1,0,1,1,1,0,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ø (0xF8)
		{ 249, 5, 7, 7, 0, {0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ù (0xF9)
		{ 250, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ú (0xFA)
		{ 251, 5, 7, 7, 0, {0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // û (0xFB)
		{ 252, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ü (0xFC)
		{ 253, 5, 7, 7, 0, {0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ý (0xFD)
		{ 254, 5, 6, 6, 0, {1,0,0,0,0,1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // þ (0xFE)
		{ 255, 5, 7, 7, 0, {0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} }, // ÿ (0xFF)
	};

	static constexpr std::size_t kGlyphCount = sizeof(xenonGlyphs) / sizeof(xenonGlyphs[0]);

public:
	struct Glyph {
		uint32_t width = 0;
		uint32_t height = 0;
		int32_t top = 0;
		int32_t left = 0;
		std::vector<uint8_t> data;
		
		uint8_t operator[](size_t index) const {return data.at(index);}
	};

	static const XenonGlyph* FindGlyph(uint32_t codepoint) {
		if (codepoint < kFirstCodepoint || codepoint > kLastCodepoint) {
			return nullptr;
		}
		const std::size_t index = static_cast<std::size_t>(codepoint - kFirstCodepoint);
		return &xenonGlyphs[index];
	}

	static const XenonGlyph* ResolveGlyph(char32_t codepoint) {
		if (const auto* glyph = FindGlyph(static_cast<uint32_t>(codepoint))) {
			return glyph;
		}
		return FindGlyph(static_cast<uint32_t>('?'));
	}

	inline Glyph operator[](char32_t codepoint) const {
		Glyph glyph;
		if (const auto* data = ResolveGlyph(codepoint)) {
			glyph.width = data->width;
			glyph.height = data->height;
			glyph.top = data->top;
			glyph.left = data->left;
			glyph.data.reserve(static_cast<size_t>(glyph.width) * glyph.height);
			const size_t total = static_cast<size_t>(glyph.width) * glyph.height;
			for (size_t i = 0; i < total; ++i) {
				glyph.data.push_back(data->bitmap[i] ? 1 : 0);
			}
		}
		return glyph;
	}

	inline std::vector<Glyph> operator[](const std::string_view& text) const {
		std::vector<Glyph> glyphs;
		glyphs.reserve(text.size());
		for (size_t i = 0; i < text.size(); ) {
			unsigned char c = static_cast<unsigned char>(text[i++]);
			char32_t codepoint = 0;
			if (c < 0x80) {
				codepoint = c;
			} else if ((c >> 5) == 0x6) {
				if (i >= text.size()) {codepoint = '?';}
				else {
					codepoint = ((c & 0x1F) << 6) | (static_cast<unsigned char>(text[i++]) & 0x3F);
				}
			} else if ((c >> 4) == 0xE) {
				if (i + 1 >= text.size()) {codepoint = '?';}
				else {
					codepoint = ((c & 0xF) << 12);
					codepoint |= (static_cast<unsigned char>(text[i++]) & 0x3F) << 6;
					codepoint |= static_cast<unsigned char>(text[i++]) & 0x3F;
				}
			} else if ((c >> 3) == 0x1E) {
				if (i + 2 >= text.size()) {codepoint = '?';}
				else {
					codepoint = ((c & 0x7) << 18);
					codepoint |= (static_cast<unsigned char>(text[i++]) & 0x3F) << 12;
					codepoint |= (static_cast<unsigned char>(text[i++]) & 0x3F) << 6;
					codepoint |= static_cast<unsigned char>(text[i++]) & 0x3F;
				}
			} else {
				codepoint = '?';
			}
			glyphs.emplace_back(operator[](codepoint));
		}
		return glyphs;
	}

};

namespace {
	static inline int EdgeFunction(int x1, int y1, int x2, int y2, int x3, int y3) {
		int twoarea = ((x2 - x1) * (y3 - y1) - (y2 - y1) * (x3 - x1));
		if (twoarea == 0) return 0;
		return twoarea < 0? -1 : 1;
	}

	static inline size_t Utf8Length(const std::string_view& str) {
		size_t len = 0;
		for (size_t i = 0; i < str.length(); ++i) {
			if ((str[i] & 0xC0) != 0x80) {
				++len;
			}
		}
		return len;
	}
}

class XenonScreen {
	// constant values
	const unsigned int _textSizeX = 6;
	const unsigned int _textSizeY = 8;
	
	// configuration
	const uint32_t _width;
	const uint32_t _height;
	uint32_t _bgColor;
	uint32_t _fgColor;
	
	// state machine
	uint32_t _textSizeMultiplier = 1;
	uint32_t _textAlign = XENONCODE_NONE;
	uint32_t _newlineSpacing = 1;
	void ResetState() {
		_textSizeMultiplier = 1;
		_textAlign = XENONCODE_NONE;
		_newlineSpacing = 1;
	}
	
	// data
	std::vector<uint32_t> _pixels;
	std::vector<uint32_t> _stagingBuffer;
	bool _dirty = false;
	uint32_t _click_x = 0;
	uint32_t _click_y = 0;
	bool _clicked = false;
	bool _clickHold = false;
	
	XenonFontRenderer fontRenderer;

public:
	virtual ~XenonScreen() = default;
	
	virtual bool Update();
	
	virtual void ResetClick() {
		_clicked = false;
		_click_x = 0;
		_click_y = 0;
		_clickHold = false;
	}
	
	virtual void ClickHold(uint32_t x, uint32_t y) {
		_click_x = x;
		_click_y = y;
		_clickHold = true;
	}
	
	virtual void Click(uint32_t x, uint32_t y) {
		_click_x = x;
		_click_y = y;
		_clickHold = true;
		_clicked = true;
	}
	
	virtual bool GetClick() const {
		return _clicked;
	}
	
	virtual bool ConsumeClickHold() {
		if (_clickHold) {
			_clickHold = false;
			return true;
		}
		return false;
	}
	
	uint32_t GetClickX() {return _click_x;}
	uint32_t GetClickY() {return _click_y;}
	
	uint32_t GetWidth() const {return _width;}
	uint32_t GetHeight() const {return _height;}
	
	uint32_t GetCharWidth() const {return _textSizeX * _textSizeMultiplier;}
	uint32_t GetCharHeight() const {return _textSizeY * _textSizeMultiplier;}
	
	void SetBgColor(uint32_t color) {
		_bgColor = color;
		Blank();
	}
	uint32_t GetBgColor() const {
		return _bgColor;
	}
	
	void SetFgColor(uint32_t color) {
		_fgColor = color;
	}
	uint32_t GetFgColor() const {
		return _fgColor;
	}
	
	void SetTextSize(uint32_t multiplier) {
		_textSizeMultiplier = std::clamp(multiplier, 1u, 64u);
	}
	uint32_t GetTextSize() const {
		return _textSizeMultiplier;
	}
	
	void SetTextAlign(uint32_t align) {
		_textAlign = align;
	}
	uint32_t GetTextAlign() const {
		return _textAlign;
	}
	
	void SetNewlineSpacing(uint32_t spacing) {
		_newlineSpacing = std::clamp(spacing, 0u, 2048u);
	}
	uint32_t GetNewlineSpacing() const {
		return _newlineSpacing;
	}
	
	uint8_t* data() {return reinterpret_cast<uint8_t*>(_pixels.data());}
	const uint8_t* data() const {return reinterpret_cast<const uint8_t*>(_pixels.data());}
	size_t size() const {return _pixels.size() * sizeof(uint32_t);}
	
	void Dirty() {
		_dirty = true;
	}
	
	XenonScreen(uint32_t width, uint32_t height, const std::vector<uint32_t>& pixels, uint32_t bgColor = XENONCODE_COLOR(0,0,0,255), uint32_t fgColor = XENONCODE_DEFAULT_COLOR)
		: _width(width)
		, _height(height)
		, _bgColor(bgColor)
		, _fgColor(fgColor)
		, _pixels(pixels)
		, _stagingBuffer(pixels)
	{}
	
	XenonScreen(uint32_t width, uint32_t height, uint32_t bgColor = XENONCODE_COLOR(0,0,0,255), uint32_t fgColor = XENONCODE_DEFAULT_COLOR)
		: _width(width)
		, _height(height)
		, _bgColor(bgColor)
		, _fgColor(fgColor)
		, _pixels(_width * _height, bgColor)
		, _stagingBuffer(_width * _height, bgColor)
	{}
	
	// Public functions
	
	void Blank() {Blank(_bgColor);}
	void Blank(uint32_t color);
	void Write(uint32_t color, const std::string_view& text) {Write(0,0, color, text);}
	void Write(const std::string_view& text) {Write(_fgColor, text);}
	void Write(int x, int y, uint32_t color, const std::string_view& text);
	void WriteLine(int x, int y, uint32_t color, const std::string_view& text);
	void Draw(int x, int y, uint32_t color, int rectWidth = 1, int rectHeight = 1);
	uint32_t GetPixel(int x, int y) const;
	
	void DrawPoint(int x, int y, uint32_t color);
	void DrawLine(int x1, int y1, int x2, int y2, uint32_t color);
	void DrawRect(int x1, int y1, int x2, int y2, uint32_t color, uint32_t fillColor = 0);
	void DrawTriangle(int x1, int y1, int x2, int y2, int x3, int y3, uint32_t color, uint32_t fillColor = 0);
	void DrawCircle(int x, int y, int radius, uint32_t color, uint32_t fillColor = 0);
	void DrawPoly(uint32_t color, const std::vector<int>& args);
};

inline void XenonScreen::Blank(uint32_t color) {
	std::fill(_pixels.begin(), _pixels.end(), color);
	_dirty = true;
}

inline void XenonScreen::WriteLine(int x, int y, uint32_t color, const std::string_view& text) {
	uint8_t r = XENONCODE_COLOR_R(color);
	uint8_t g = XENONCODE_COLOR_G(color);
	uint8_t b = XENONCODE_COLOR_B(color);
	uint8_t a = XENONCODE_COLOR_A(color);
	const auto glyphs = fontRenderer[text.substr(0, 1024)];
	int glyphHeight = (_textSizeY-1)*_textSizeMultiplier;
	for (const auto& glyph : glyphs) {
		for (int yy = 0; yy < int(glyph.height); ++yy) {
			if (yy + y >= int(_height)) break;
			for (int xx = 0; xx < int(glyph.width); ++xx) {
				if (xx + x >= int(_width)) break;
				if (glyph[yy * int(glyph.width) + xx]) {
					for (int ix = 0; ix < int(_textSizeMultiplier); ++ix) {
						for (int iy = 0; iy < int(_textSizeMultiplier); ++iy) {
							int xxx = x + xx*_textSizeMultiplier + ix + glyph.left*_textSizeMultiplier;
							int yyy = y + yy*_textSizeMultiplier + iy + glyphHeight - glyph.top*_textSizeMultiplier;
							if (xxx >= 0 && xxx < int(_width) && yyy >= 0 && yyy < int(_height)) {
								size_t index = yyy * _width + xxx;
								if (index < _pixels.size()) {
									if (a == 255) {
										_pixels[index] = color;
									} else {
										uint32_t prev = _pixels[index];
										uint8_t prev_r = XENONCODE_COLOR_R(prev);
										uint8_t prev_g = XENONCODE_COLOR_G(prev);
										uint8_t prev_b = XENONCODE_COLOR_B(prev);
										uint8_t prev_a = XENONCODE_COLOR_A(prev);
										_pixels[index] = XENONCODE_COLOR(
											((r * a + prev_r * (255 - a)) / 255),
											((g * a + prev_g * (255 - a)) / 255),
											((b * a + prev_b * (255 - a)) / 255),
											uint8_t(std::clamp(int32_t(prev_a) + a, 0, 255))
										);
									}
								}
							}
						}
					}
				}
			}
		}
		x += _textSizeX*_textSizeMultiplier;
	}
	_dirty = true;
}

inline void XenonScreen::Write(int x, int y, uint32_t color, const std::string_view& text) {
	if (!color) return;
	std::vector<std::string_view> lines;{
		size_t pos = 0;
		for (size_t i = 0; int(i) < int(text.size())-1; ++i) {
			if (text[i] == '\\' && text[i+1] == 'n') {
				lines.emplace_back(text.data() + pos, i - pos);
				pos = i + 2;
				++i;
			} else if (text[i] == '\n') {
				lines.emplace_back(text.data() + pos, i - pos);
				pos = i + 1;
			}
		}
		if (pos < text.size()) {
			lines.emplace_back(text.data() + pos, text.back() == '\n'? (text.size() - pos - 1) : (text.size() - pos));
		}
	}
	uint32_t lineHeight = (_textSizeY + _newlineSpacing - 1) * _textSizeMultiplier; 
	if (_textAlign & XENONCODE_TOP) {
		y += 1;
	} else if (_textAlign & XENONCODE_BOTTOM) {
		y += GetHeight() - lines.size()*lineHeight + _newlineSpacing * _textSizeMultiplier - 1;
	} else if (_textAlign & XENONCODE_CENTER) {
		y += std::max(1, int(GetHeight() / 2 - lines.size()*lineHeight / 2 + _newlineSpacing * _textSizeMultiplier / 2));
	}
	int x0 = x;
	for (const auto& line : lines) {
		x = x0;
		if (_textAlign & XENONCODE_LEFT) {
			x += 1;
		} else if (_textAlign & XENONCODE_RIGHT) {
			x += GetWidth() - Utf8Length(line)*_textSizeX*_textSizeMultiplier - 1 + _textSizeMultiplier;
		} else if (_textAlign & XENONCODE_CENTER) {
			x += std::max(1, int(GetWidth() / 2 - Utf8Length(line)*_textSizeX*_textSizeMultiplier / 2));
		}
		if (line.size() > 0) WriteLine(x, y, color, line);
		y += lineHeight;
	}
}

inline void XenonScreen::Draw(int x, int y, uint32_t color, int rectWidth, int rectHeight) {
	rectWidth = std::clamp(rectWidth, 0, std::max(0, int(_width - x)));
	rectHeight = std::clamp(rectHeight, 0, std::max(0, int(_height - y)));
	if (rectWidth <= 0 || rectHeight <= 0 || !color) return;
	uint32_t a = XENONCODE_COLOR_A(color);
	uint32_t r = XENONCODE_COLOR_R(color) * a;
	uint32_t g = XENONCODE_COLOR_G(color) * a;
	uint32_t b = XENONCODE_COLOR_B(color) * a;
	for (int yy = 0; yy < rectHeight; ++yy) {
		unsigned int yyy = std::max(0, y + yy);
		if (yyy >= _height) break;
		for (int xx = 0; xx < rectWidth; ++xx) {
			unsigned int xxx = std::max(0, x + xx);
			if (xxx >= _width) break;
			size_t index = yyy * _width + xxx;
			if (xxx < _width && yyy < _height) {
				if (index < _pixels.size()) {
					if (a == 255) {
						_pixels[index] = color;
					} else {
						uint32_t prev = _pixels[index];
						uint32_t prev_r = XENONCODE_COLOR_R(prev);
						uint32_t prev_g = XENONCODE_COLOR_G(prev);
						uint32_t prev_b = XENONCODE_COLOR_B(prev);
						uint32_t prev_a = XENONCODE_COLOR_A(prev);
						_pixels[index] = XENONCODE_COLOR(
							((r + prev_r * (255 - a)) / 255),
							((g + prev_g * (255 - a)) / 255),
							((b + prev_b * (255 - a)) / 255),
							uint8_t(std::clamp(int32_t(prev_a) + int32_t(a), 0, 255))
						);
					}
				}
			}
		}
	}
	_dirty = true;
}

inline uint32_t XenonScreen::GetPixel(int x, int y) const {
	size_t index = y * _width + x;
	if (index < _pixels.size()) {
		return _pixels[index];
	}
	return 0;
}

inline void XenonScreen::DrawPoint(int x, int y, uint32_t color) {
	if (!color) return;
	if (x < 0 || y < 0 || x >= int(_width) || y >= int(_height)) return;
	size_t index = y * _width + x;
	if (index < _pixels.size()) {
		uint8_t a = XENONCODE_COLOR_A(color);
		if (a == 255) {
			_pixels[index] = color;
		} else {
			uint32_t prev = _pixels[index];
			_pixels[index] = XENONCODE_COLOR(
				((XENONCODE_COLOR_R(color) * a + XENONCODE_COLOR_R(prev) * (255 - a)) / 255),
				((XENONCODE_COLOR_G(color) * a + XENONCODE_COLOR_G(prev) * (255 - a)) / 255),
				((XENONCODE_COLOR_B(color) * a + XENONCODE_COLOR_B(prev) * (255 - a)) / 255),
				uint8_t(std::clamp(int32_t(XENONCODE_COLOR_A(prev)) + a, 0, 255))
			);
		}
		_dirty = true;
	}
}

inline void XenonScreen::DrawLine(int x1, int y1, int x2, int y2, uint32_t color) {
	float dx = float(x2 - x1);
	float dy = float(y2 - y1);
	float steps = std::max(std::abs(dx), std::abs(dy));
	if (steps > 10000) return; // avoid bad values causing near-infinite loops
	if (steps/8 > _width + _height) return;
	dx /= steps;
	dy /= steps;
	float x = float(x1) + 0.5f;
	float y = float(y1) + 0.5f;
	for (int i = 0; i < steps; ++i) {
		DrawPoint(int(x), int(y), color);
		x += dx;
		y += dy;
	}
}

inline void XenonScreen::DrawRect(int x1, int y1, int x2, int y2, uint32_t color, uint32_t fillColor) {
	if (x1 > x2) std::swap(x1, x2);
	if (y1 > y2) std::swap(y1, y2);
	if (color && color != fillColor) {
		DrawLine(x1, y1, x2, y1, color); // top
		DrawLine(x1, y2-1, x2, y2-1, color); // bottom
		DrawLine(x1, y1, x1, y2, color); // left
		DrawLine(x2-1, y1, x2-1, y2, color); // right
		++x1;
		++y1;
		--x2;
		--y2;
	}
	if (fillColor) {
		Draw(x1, y1, fillColor, x2-x1, y2-y1);
	}
}

inline void XenonScreen::DrawTriangle(int x1, int y1, int x2, int y2, int x3, int y3, uint32_t color, uint32_t fillColor) {
	if (fillColor) {
		int sign = EdgeFunction(x1, y1, x2, y2, x3, y3);
		int minX = std::min({x1, x2, x3});
		int minY = std::min({y1, y2, y3});
		int maxX = std::max({x1, x2, x3});
		int maxY = std::max({y1, y2, y3});
		for (int y = minY; y <= maxY; ++y) {
			for (int x = minX; x <= maxX; ++x) {
				if (EdgeFunction(x2, y2, x3, y3, x, y) == sign && EdgeFunction(x3, y3, x1, y1, x, y) == sign && EdgeFunction(x1, y1, x2, y2, x, y) == sign) {
					DrawPoint(x, y, fillColor);
				}
			}
		}
	}
	if (color) {
		DrawLine(x1, y1, x2, y2, color);
		DrawLine(x2, y2, x3, y3, color);
		DrawLine(x3, y3, x1, y1, color);
	}
}

inline void XenonScreen::DrawCircle(int x, int y, int radius, uint32_t color, uint32_t fillColor) {
	int radiusMinusOne = radius - 1;
	int minY = std::max(0, y - radius) - y;
	int minX = std::max(0, x - radius) - x;
	int maxY = std::min(int(_height), y + radius) - y;
	int maxX = std::min(int(_width), x + radius) - x;
	for (int yy = minY; yy <= maxY; ++yy) {
		for (int xx = minX; xx <= maxX; ++xx) {
			int len2 = xx*xx + yy*yy;
			if (len2 < radius*radius) {
				if (color && len2 >= radiusMinusOne*radiusMinusOne) {
					DrawPoint(x + xx, y + yy, color);
				} else if (fillColor) {
					DrawPoint(x + xx, y + yy, fillColor);
				}
			}
		}
	}
}

inline void XenonScreen::DrawPoly(uint32_t color, const std::vector<int>& args) {
	Dirty();
	if (args.size() < 6 || args.size() % 2 != 0) {
		return;
	}
	int numPoints = args.size() / 2;
	std::vector<int> polyX(numPoints);
	std::vector<int> polyY(numPoints);
	for (int i = 0; i < numPoints; i++) {
		polyX[i] = args[i * 2];
		polyY[i] = args[i * 2 + 1];
	}
	
	int minY = *std::min_element(polyY.begin(), polyY.end());
	int maxY = *std::max_element(polyY.begin(), polyY.end());
	minY = std::max(0, minY);
	maxY = std::min(static_cast<int>(_height) - 1, maxY);
	for (int y = minY; y <= maxY; y++) {
		std::vector<int> intersections;
		for (int i = 0; i < numPoints; i++) {
			int j = (i + 1) % numPoints;
			if ((polyY[i] <= y && polyY[j] > y) || 
				(polyY[j] <= y && polyY[i] > y)) {
				int x = polyX[i] + (y - polyY[i]) * (polyX[j] - polyX[i]) / (polyY[j] - polyY[i]);
				intersections.push_back(x);
			}
		}
		std::sort(intersections.begin(), intersections.end());
		for (size_t i = 0; i < intersections.size(); i += 2) {
			if (i + 1 < intersections.size()) {
				int startX = std::max(0, intersections[i]);
				int endX = std::min(static_cast<int>(_width) - 1, intersections[i + 1]);
				
				for (int x = startX; x <= endX; x++) {
					DrawPoint(x, y, color);
				}
			}
		}
	}
	for (int i = 0; i < numPoints; i++) {
		int j = (i + 1) % numPoints;
		DrawLine(polyX[i], polyY[i], polyX[j], polyY[j], color);
	}
}

inline bool XenonScreen::Update() {
	ResetState();
	if (_dirty) {
		_dirty = false;
		if (std::memcmp(_stagingBuffer.data(), _pixels.data(), _pixels.size() * sizeof(uint32_t))) {
			std::memcpy(_stagingBuffer.data(), _pixels.data(), _pixels.size() * sizeof(uint32_t));
			return true;
		}
	}
	return false;
}
